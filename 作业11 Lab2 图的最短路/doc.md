## Lab2：图的最短路


### 一、实验介绍

最短路问题是图论理论的一个经典问题，旨在寻找图中两顶点之间的最短路径。
最短路问题在实际生活中有非常广泛的应用，解决这类问题的经典算法有Dijkstra算法、Floyd算法等等。

在本实验中，你需要解决一个单源最短路问题的变种。


### 二、问题描述

鱼贩高启强从勃北市进了一批水产，要回到京海市销售。这两个城市（含）之间共有$N$个港口，它们之间有$M$条航线相连。每条航线都是单向的，并且构成了一张有向无环图。

高启强从勃北市出发，沿着一条航线到达另一个港口，并最终到达京海市。每条航线的边权，表示从一个港口到另一个港口需要花费的时间。受到潮汐影响，该时间会在$[lower, upper]$内以$step$为步幅波动。$t=0$时，所有航线的边权都是$upper$，$t=1$时刻，边权变化为$upper-step$，以此类推。当某航线的边权变为$lower$后，下一时刻它的边权会变为$lower + step$，直至变为$upper$，此为一个完整的变化周期。每条航线的航行时间在**踏上该条航线**时就已经被确定了，不会在于该航线的航行过程中发生变化。

高启强可以在勃北市等待出发，但是出发的时间必须是$K$的整数倍，否则会被勃北市海事局拦截。中间港口停靠需要缴纳费用，但是高启强没有钱，因此他不能在中间港口等待，只能在到达某港口后立刻踏上下一条航线。

高启强想知道，他于何时出发，最少需要花费多少时间才能到达京海市。

### 三、输入输出

你的程序通过`stdin`接受输入，并将结果输出到`stdout`。

每个测试用例包括：
1. 第一行为3个整数$N$, $M$, $K$。
2. 接下来的$M$行描述图中的$M$条边，每行为4个整数$u$, $v$, $lower$，$upper$, $step$，表示一条从$u$到$v$的边，边权在$[lower, upper]$之间以$step$的步幅变化。

请注意：
1. 输入只保证给出的是有向无环图，不意味着对每条边都有$u \lt v$。
2. 在$N$个顶点中，编号为$0$和$N-1$的顶点分别代表勃北市和京海市，数据保证它们分别是拓扑序最小和最大的顶点。

输出为一行两个整数，用空格隔开，分别为高启强从勃北市出发的时间和到达京海市的时间。

### 四、数据范围

有向无环图的顶点数$N$和边数$M$满足：
$$
1 \lt N \lt M \le 1000
$$
出发时间步幅$K$满足：
$$
1 \le K \le 50
$$
每条边的$lower$, $upper$和$step$满足：
$$
1 \le lower \le upper \le 2000
$$
且
$$
(upper - lower) \mod step = 0
$$

### 五、样例

#### 输入
```
4 5 1
0 1 1 3 2
1 2 1 7 3
2 3 4 9 1
0 2 2 10 2
1 3 7 8 1
```
#### 输出
```
1 9
```
#### 解释

在这张图中，点$0$和点$3$分别表示勃北市和京海市，且最优方案是：
1. 在勃北市等待$1$个单位时间，出发时间为$t=1$。
2. 从勃北市出发，沿着航线$0 \to 1$到达港口$1$。该航线在$t=1$时刻的权值为$3 - 1 * 2 = 1$，因此航行消耗了$1$个单位时间，到达时间为$t=2$。
3. 从港口$1$出发，沿着航线$1 \to 2$到达港口$2$。该航线在$t=2$时刻的权值为$7 - 2 * 3 = 1$，因此航行消耗了$1$个单位时间，到达时间为$t=3$。
4. 从港口$2$出发，沿着航线$2 \to 3$到达京海市。该航线在$t=3$时刻的权值为$9 - 3 * 1 = 6$，因此航行消耗了$6$个单位时间，到达时间为$t=9$。

### 六、实现提示

1. 一种解法：对给定的出发时间，按照拓扑序遍历图中所有顶点，维护到达每个顶点的所有可能时间点，并将这些时间点按照拓扑序传播，直到终点。
2. 显然，高启强可以在起点等待边权降低，使需要花费的总时间减少。等待的时间存在上限，超出该上限后，边权降低带来的收益无法弥补推迟出发的惩罚。如何简单估算出这个上限？（不一定需要很紧凑）
3. 如何利用这个上限，对1中描述的解法进行剪枝？

### 七、探究实验

请完成一份书面报告，要求：

- **简述**一下你的解题思路。
- 简单**定性**描述一下，输入数据满足什么要求时，在起点等待一下再出发反而会让到达终点的时间更少？

在书面报告中，你不需要使用图表或者公式，只需要用文字描述你的想法即可。

我们不鼓励在实验报告上无意义内卷，因此实验报告**不应**超过1000字，且字数多少不影响我们对实验报告的评判。

### 八、实验评分

我们提供了Makefile文件，在主目录下执行`make`指令生成可执行程序`graph`。

**提交实验请将单个C++源代码文件上传Canvas，命名使用“学号+姓名+lab2.cc”，如“521123456789+张三+lab2.cc”。**

**探究实验报告同样上传到Canvas平台（会有单独作业用于提交），要求PDF格式，命名无要求。**

Lab2截止日期为北京时间**2023年5月7日21:59**（最终截止时间以 canvas 系统为准）。


### 九、注意事项

1. 切勿抄袭！若发现明显雷同现象，该实验评分将以0分计。
2. 注意实验截止日期，迟交或不交会视情况扣分。
3. 请注意按照实验要求完成，避免因为自动脚本评分造成的判分失误。
4. 有问题可通过[邮件](mailto:zhaoyifan@sjtu.edu.cn)或微信群联系助教赵逸凡。
